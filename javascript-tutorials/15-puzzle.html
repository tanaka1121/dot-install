<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>15 Puzzle!</title>
</head>
<body>
  <canvas id = "stage" width="280" height="280">
    Canvas not supported ...
  </canvas>
  <script>
  (function() {
    'use strict';
    var canvas = document.getElementById('stage');
    var context;
    var image;
    var IMAGE_URL = '15puzzle.png';
    // tils[0][0]=0;
    //tils[0][1]=1;
    //tils[0][2]=2;
    //tils[0][3]=3;
    //tils[1][0]=4;
    // ...

    var tiles = [];
    var ROW_COUNT = 4;
    var COL_COUNT = 4;

    function initTiles() {
      var row, col;
      for (row = 0; row < ROW_COUNT; row++) {
      tiles[row] = [];
        for (col = 0; col < COL_COUNT; col++) {
          tiles[row][col] = row * COL_COUNT + col;
        }
      }
      console.log(tiles);
    }

    function drawPuzzle() {
      var row, col;
      var sx, sy;
      var dx, dy;

      var w = 70;
      var h = 70;

      for (row = 0; row < ROW_COUNT; row++) {
        for (col = 0; col < COL_COUNT; col++) {
           dx = col * w;
           dy = row * h;
           sx = (tiles[row][col] % COL_COUNT) * w;
           sy = Math.floor((tiles[row][col] / ROW_COUNT)) * h ;
          context.drawImage(image, sx, sy, w, h, dx, dy, w, h);
        }
      }

      var dx = col * w;
      var dy = row * h;

      var sx = (tiles[row][col] % COL_COUNT) * w;
      var sy = Math.floor((tiles[row][col] / ROW_COUNT)) * h ;
      context.drawImage(image, sx, sy, w, h, dx, dy, w, h);
      //context.drawImage(image, 0 , 0);
    }

    if (!canvas.getContext) {
      alert('Canvas not supported ...');
      return;
    }
    context = canvas.getContext('2d');

    image = document.createElement('img');
    image.src = IMAGE_URL;
    image.addEventListener('load', function() {
      initTiles();
      drawPuzzle();
    });

  })();
  </script>
</body>
</html>
